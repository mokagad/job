name: ci

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */2 * * *" 

jobs:
  ci:
    runs-on: ubuntu-latest
    steps:
      - name: pull image
        run: docker pull ahmedhesham301/jobfit-ai:latest

      # - name: checkout
      #   uses: actions/checkout@v5.0.0

      # - name: install gh cli
      #   run: sudo apt update && sudo apt install gh -y

      - name: get info about current and last run
        run: gh run list --workflow main.yml --limit 2 --json createdAt,status,conclusion --repo $repo
        env: 
          GH_TOKEN: ${{ github.token }}
          repo: ${{ github.action_repository }}
      
      - name: Create .env file
        run: |
          echo "smtp_email=${{ secrets.SMTP_EMAIL }}" >> .env
          echo "smtp_password=${{ secrets.SMTP_PASSWORD }}" >> .env
          echo "receiver_email=${{ secrets.RECEIVER_EMAIL }}" >> .env
          echo "api_keys=${{ secrets.API_KEYS }}" >> .env
      - name: Run container
        run: docker run --env-file .env ahmedhesham301/jobfit-ai:latest
